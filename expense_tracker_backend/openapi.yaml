openapi: 3.0.3
info:
  title: Smart Expense Tracker API
  version: "1.0.0"
  description: |
    REST API for transactions, budgets, goals, reports, health, authentication, accounts, and profile.
servers:
  - url: http://localhost:8080
tags:
  - name: Health
  - name: Auth
  - name: Profile
  - name: Accounts
  - name: Transactions
  - name: Budgets
  - name: Goals
  - name: Reports
  - name: Categories
paths:
  /health:
    get:
      tags: [Health]
      summary: Health check
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
  /auth/register:
    post:
      tags: [Auth]
      summary: User registration
      description: Create a new user account.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, name]
              properties:
                email: { type: string, format: email }
                password: { type: string, minLength: 8 }
                name: { type: string, minLength: 1 }
      responses:
        "201": { description: Registration successful }
        "400": { description: Invalid input }
  /auth/login:
    post:
      tags: [Auth]
      summary: User login
      description: Authenticate user and return JWT token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string }
      responses:
        "200": { description: Login successful, returns token and user }
        "401": { description: Invalid credentials }
  /profile:
    get:
      tags: [Profile]
      summary: Get user profile
      security: [{ bearerAuth: [] }]
      responses:
        "200": { description: Profile data }
        "401": { description: Unauthorized }
    put:
      tags: [Profile]
      summary: Update user profile
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name: { type: string }
                notificationPreferences: { type: object }
      responses:
        "200": { description: Profile updated }
        "400": { description: Invalid input }
        "401": { description: Unauthorized }
  /accounts:
    get:
      tags: [Accounts]
      summary: Get linked bank accounts
      security: [{ bearerAuth: [] }]
      responses:
        "200": { description: List of accounts }
        "401": { description: Unauthorized }
  /transactions:
    get:
      tags: [Transactions]
      summary: List transactions
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: limit
          schema: { type: integer, maximum: 200 }
        - in: query
          name: offset
          schema: { type: integer, minimum: 0 }
        - in: query
          name: accountId
          schema: { type: string, format: uuid }
        - in: query
          name: from
          schema: { type: string, format: date }
        - in: query
          name: to
          schema: { type: string, format: date }
        - in: query
          name: category
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Transactions list
          content:
            application/json:
              schema:
                type: array
                items: { type: object }
    post:
      tags: [Transactions]
      summary: Create transaction
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_id, amount, direction, transaction_date]
              properties:
                user_id: { type: string, format: uuid }
                account_id: { type: string, format: uuid, nullable: true }
                category_id: { type: string, format: uuid, nullable: true }
                amount: { type: number }
                direction: { type: string, enum: [inflow, outflow] }
                description: { type: string, nullable: true }
                transaction_date: { type: string, format: date }
      responses:
        "201": { description: Created }
  /transactions/{id}:
    put:
      tags: [Transactions]
      summary: Update transaction
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        "200": { description: Updated }
    delete:
      tags: [Transactions]
      summary: Delete transaction
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200": { description: Deleted indicator }
  /transactions/summary:
    get:
      tags: [Transactions]
      summary: Summary by period
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: range
          schema: { type: string, enum: [week, month, year], default: month }
      responses:
        "200": { description: Summary list }
  /budgets:
    get:
      tags: [Budgets]
      summary: List budgets with spent and overrun flag
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: Budgets list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
    post:
      tags: [Budgets]
      summary: Create budget
      security: [{ bearerAuth: [] }]
      description: Create a monthly budget for a category. Uniqueness is enforced per (user_id, category_id, month).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_id, category_id, month, limit_amount]
              properties:
                user_id: { type: string, format: uuid, description: User UUID who owns the budget }
                category_id: { type: string, format: uuid, description: Category UUID (expense) }
                month: { type: string, description: Month as YYYY-MM or date (YYYY-MM-01). Will be normalized to first of month. }
                period: { type: string, enum: [monthly], description: Optional period enum; currently only 'monthly' is supported. }
                limit_amount: { type: number, description: Positive budget limit amount }
      responses:
        "201":
          description: Created budget
          content:
            application/json:
              schema:
                type: object
        "400": { description: Invalid body }
        "409": { description: Conflict - budget already exists for this month and category }
  /budgets/{id}:
    put:
      tags: [Budgets]
      summary: Update budget
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        "200": { description: Updated }
    delete:
      tags: [Budgets]
      summary: Delete budget
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted: { type: integer }
  /goals:
    get:
      tags: [Goals]
      summary: List goals
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: Goals list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
    post:
      tags: [Goals]
      summary: Create goal
      security: [{ bearerAuth: [] }]
      description: Create a savings goal with name, target amount, and optional target date/current amount.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_id, name, target_amount]
              properties:
                user_id: { type: string, format: uuid, description: Owner user UUID }
                name: { type: string, minLength: 1, maxLength: 160, description: Goal name }
                target_amount: { type: number, description: Positive target amount }
                current_amount: { type: number, description: Non-negative current progress amount (defaults to 0) }
                target_date: { type: string, format: date, description: Optional target date (YYYY-MM-DD) }
      responses:
        "201":
          description: Created goal
          content:
            application/json:
              schema:
                type: object
        "400":
          description: Invalid body
  /goals/{id}:
    put:
      tags: [Goals]
      summary: Update goal
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        "200": { description: Updated }
    delete:
      tags: [Goals]
      summary: Delete goal
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted: { type: integer }
  /reports/spending-by-category:
    get:
      tags: [Reports]
      summary: Spending by category for period
      security: [{ bearerAuth: [] }]
      description: |
        Returns total outflows grouped by expense categories for a given period.
        - Default period is current month when no query is provided.
        - If `from`/`to` are provided (YYYY-MM-DD), they override `range`.
        - `range=quarter` or `range=3months` will include the current month and previous 2 months.
      parameters:
        - in: query
          name: range
          description: Period preset. If from/to are provided, they override range.
          schema:
            type: string
            enum: [month, quarter, 3months]
            default: month
        - in: query
          name: from
          description: Inclusive start date (YYYY-MM-DD)
          schema: { type: string, format: date }
        - in: query
          name: to
          description: Inclusive end date (YYYY-MM-DD)
          schema: { type: string, format: date }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 200, default: 50 }
        - in: query
          name: offset
          schema: { type: integer, minimum: 0, default: 0 }
      responses:
        "200":
          description: List of categories with totals
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    categoryName: { type: string, example: "Food & Dining" }
                    total: { type: number, example: 245.75, description: "Positive sum of outflows for the category in the period" }
                    currency: { type: string, example: "USD" }
  /reports/income-vs-expense:
    get:
      tags: [Reports]
      summary: Income vs Expense by month for period
      security: [{ bearerAuth: [] }]
      description: |
        Returns monthly totals for income vs expense for the selected period.
        - Default period is current month.
        - For `range=quarter` or `range=3months`, the result aggregates the current month plus previous 2 months.
        - If `from`/`to` are provided, they override `range` and the output includes each month within the bounds.
      parameters:
        - in: query
          name: range
          description: Period preset. If from/to are provided, they override range.
          schema:
            type: string
            enum: [month, quarter, 3months]
            default: month
        - in: query
          name: from
          description: Inclusive start date (YYYY-MM-DD)
          schema: { type: string, format: date }
        - in: query
          name: to
          description: Inclusive end date (YYYY-MM-DD)
          schema: { type: string, format: date }
      responses:
        "200":
          description: Periodized income vs expense list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    period: { type: string, example: "2025-03" }
                    income: { type: number, example: 5500.00 }
                    expense: { type: number, example: 3240.25, description: "Positive totals of outflows" }
                    net: { type: number, example: 2259.75, description: "income - expense" }
  /reports/alerts:
    get:
      tags: [Reports]
      summary: Alerts (stub)
      security: [{ bearerAuth: [] }]
      responses:
        "200": { description: List of alerts (empty for now) }
  /categories:
    get:
      tags: [Categories]
      summary: List categories
      security: [{ bearerAuth: [] }]
      description: |
        Returns categories ordered by name. Supports filtering by type and user_id, and optionally including global defaults.
      parameters:
        - in: query
          name: type
          schema: { type: string, enum: [income, expense] }
          description: Filter by category type.
        - in: query
          name: user_id
          schema: { type: string, format: uuid }
          description: User UUID to fetch user-specific categories.
        - in: query
          name: include_defaults
          schema: { type: boolean }
          description: When true and user_id provided, include global defaults too. Default true if user_id is provided.
      responses:
        "200":
          description: Categories list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id: { type: string, format: uuid }
                    user_id: { type: string, format: uuid, nullable: true }
                    name: { type: string }
                    type: { type: string, enum: [income, expense] }
                    icon: { type: string, nullable: true }
                    is_default: { type: boolean }
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
